---
title: microCMSを無料枠で効率的に使うために、サービスをいかに削れるか考える。
tags:
  - microCMS
private: true
updated_at: '2024-02-16T03:25:47+09:00'
id: ab3e73c1bf7ba1ae8b1e
organization_url_name: null
slide: false
ignorePublish: false
---
運用の話が強めです。

私は、ブログのコンテンツも、複数のブログで使い回すサイトガチェットも、インターフェースとしてのGASも色々と使っており、データ管理を一元化したいなと思っていました。
今まではスプレッドシートをデータベースのように使っていたのですが、システム用に作ったファイルと要件定義など業務で作っているドキュメントとしてのファイルが混在しており、非常に管理が煩雑になっていました。
ディレクトリで分けたりファイル名で工夫したり、と思いつく事を色々やったんですが、そもそも単一ファイルとしてスプレッドシートで巨大なコンテンツを扱うのが難しい（やってやれないことはないですが、ブログの記事をスプレッドシートに書いてGitで管理する場合などは非常に手間）ので、これを解消する方法です。

# 何が嬉しいの？
- microCMSの無料プランだとサービスの利用数に制限がある。これを擬似的に解決できる。
- 各サービスの一部に変更があった場合でもすべてのアプリに変更を適用できる（DBっぽい使い方ができる）

後者はスプレッドシートでもできるので、ここで取り上げたいのは前者です。

# microCMSの設定
全体としては、このように管理しています。

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/122800/3d0d3d7c-1e50-6761-fc19-eb4b0c2cc187.png)

コンテンツに着目していきましょう。
## ○○の許可設定
この内容でスキーマを作成します。
``` schema.json
[
  {
    "fieldId": "value",
    "name": "値",
    "kind": "text",
    "description": "許可するコンテンツAPI名を設定する。【要変更】作成したcontentIdはkeyとして使用する",
    "required": true
  }
]
```
一つしか項目がないのでとてもシンプルです。
ここで作成する値は、同じサービス内のコンテンツAPI名です。

たとえば、「お絵かきLINEBOTの許可設定」の場合はlineのコンテンツAPIだけを使わせたいので、値にはlineだけとします。
「slack-line連携の許可設定」の場合は、lineとslackのコンテンツAPIを使わせたいので、値にはlineとslackを登録します。

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/122800/602fd46d-c353-17dc-a3b9-ec108e73ba4c.png)

各コンテンツAPIはこのようになっています。
先程のスキーマを使いまわしていますが、解説用に「メモ」を追加しました。

<script src="https://gist.github.com/shimajima-eiji/5d8f911841264c51b8b59f385ce0270b.js"></script>

全体のスクリプトとしてはこうなります。
ここで設定するPERMISSION_CONTENTIDはそれぞれの許可設定で指定したものです。
**これを間違えると大変な事になります。**

解説はコメントの通りですが、`findValue_array`は`...contents.filter((object)=>object.id==target)`です。
私はまだGASのV8ランタイムを採用していないので泥臭い事をやっています…

# 問題点
その他のサービスアプリで使用するAPIキーが共通なので、一つが漏洩すれば関係するサービスすべてが漏洩した事になるため、リスク管理の観点からはおすすめしません。
私はあくまで開発を楽しみたい個人で活用しているので
商用ラインで使っている場合はきちんとサービスを分けましょう。
